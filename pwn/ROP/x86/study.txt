귀찮다..
지겹게 하던 rop다.
바이너리 컴파일 예제에서 하라는 데로 해도 항상 가젯이 부족하다.
그래서 가능하면 csu 가젯 쓰고 싶다. x64에서는 그렇게 해보겠다.
뭐 libc에도 있으면 libc에 있는 것도 써봐야지.

이번에도 오프셋은 확인은 다음과 같다
1. 입력가능한 버퍼 위치한 프레임 확인
2. 해당 프레임 진입 시 바로 esp확인
3. 입력 받을 때 buf의 주소 확인 후 (2)에서 확인한 주소와 연산을 통해 거리를 계산
4. libc leak 혹은 pie leak, 그리고 가젯을 얻어낸다.

buf ~ ret 까지의 거리는 0x3e, 62로 확인(bytes)

나의 경우 컴파일한 바이너리에 이상한 가젯밖에 안 보인다.
..님들은 pop; pop; pop; ret; 이런 정형태를 배웠을지 모르나... 나는 esp를 이동시키는 게 가젯이라고 주워들은 게 전부다.
그래서
0x0804901b : add esp, 8 ; pop ebx ; ret
이 친구도 세 개의 인자를 설정한다고 볼 수 있다.
esp+8, 이것은 pop 을 두 번 한 결과다.
이후 pop ebx, 이것은 pop을 한 번 더 한다.
즉, 세 개의 인자를 넣을 수 있다는 소리다. 할 말이 없어서 좀 써봤다.

rtl과의 다른 점이라...esp로 인자설정하는 건 당연히 비슷하고, (뒤에 들어간 값들을 esp에 더하는 연산을 함으로써 esp에 오게 만듦)
ret으로 실행 흐름을 이어주는 게 약간 다르다고 할까(ret instruction, not ret addr)...

갑자기 생각난 건데
이런 쉬운 문제를 풀 때조차 시스템 해킹은 간지가 난다. 인생을 살아갈 의미가 생기는 듯한...
요즘에는 알고리즘도 슬슬 해보려고 한다.
그리고 맨날 뒤로 밀었던 일들을 점차 해나가야하는데...
너무 귀찮다. 이게 말로 표현할 수 없다고 해야되나.
떠올리면 공포에 질려서 뭐 노력을 할 때조차 귀찮다고 생각이 날 정도..
