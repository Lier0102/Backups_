from flask import Flask, request, render_template, redirect
import sqlite3

app = Flask(__name__) # main 위치 파악용

def get_db():
    return sqlite3.connect("memo.db")

@app.route('/')
def index():
    db = get_db()
    cur = db.cursor()
    # sql = 'create table memo(id integer primary key autoincrement, title text, content text);'
    # cur.execute(sql)
    # db.commit()
    cur.execute('select id, title from memo')
    rows = cur.fetchall()

    return render_template('index.html', memos=rows)

@app.route('/write', methods=["GET", "POST"])
def write():
    if request.method == "POST":
        title = request.form["title"]
        content = request.form["content"]

        db = get_db()
        cur = db.cursor()

        sql = f"insert into memo (title, content) values ('{title}', '{content}')"
        cur.executescript(sql)
        db.commit()

        return redirect("/")
    
    return render_template("write.html")

@app.route('/delete')
def delete():
    memo_id = request.args.get('id')

    db = get_db()
    cur = db.cursor()

    cur.execute(f'delete from memo where id={memo_id}')
    db.commit()

    return redirect('/')

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=5000, debug=True) # 테스트 포트 쓰는겨